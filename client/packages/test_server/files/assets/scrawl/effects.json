{
  "$schema": "https://example.com/scrawl-effects-library.schema.json",
  "version": "1.0.0",
  "description": "Built-in scrawl effects and command presets for the script editor",
  "effects": [
    {
      "id": "log",
      "category": "Debug",
      "name": "Log Message",
      "description": "Output a message to the log",
      "template": {
        "kind": "Play",
        "effectId": "log",
        "ctx": {
          "message": "Log message",
          "level": "info",
          "data": {}
        }
      },
      "parameters": [
        {
          "name": "message",
          "type": "string",
          "default": "Log message",
          "description": "Message to log"
        },
        {
          "name": "level",
          "type": "string",
          "default": "info",
          "options": ["debug", "info", "warn", "error"],
          "description": "Log level"
        }
      ]
    },
    {
      "id": "circleMarker",
      "category": "Visual",
      "name": "Circle Marker (AOE)",
      "description": "Animated circular ground marker that expands and fades",
      "template": {
        "kind": "Play",
        "effectId": "circleMarker",
        "target": "$patient",
        "ctx": {
          "radius": 5,
          "color": "#ff6600",
          "spreadDuration": 0.5,
          "stayDuration": 2.0,
          "rotationSpeed": 1.0,
          "alpha": 0.7,
          "texture": "effects/aoe_marker.png",
          "shape": "square"
        }
      },
      "parameters": [
        {
          "name": "radius",
          "type": "number",
          "default": 5,
          "description": "Circle radius in world units"
        },
        {
          "name": "color",
          "type": "color",
          "default": "#ff6600",
          "description": "Circle color (hex)"
        },
        {
          "name": "spreadDuration",
          "type": "number",
          "default": 0.5,
          "description": "Time to expand from 0 to full radius (seconds)"
        },
        {
          "name": "stayDuration",
          "type": "number",
          "default": 2.0,
          "description": "Time to stay at full radius (seconds)"
        },
        {
          "name": "rotationSpeed",
          "type": "number",
          "default": 1.0,
          "description": "Rotation speed (radians/second, 0=no rotation)"
        },
        {
          "name": "alpha",
          "type": "number",
          "default": 0.7,
          "description": "Transparency (0-1)"
        },
        {
          "name": "texture",
          "type": "string",
          "default": "effects/aoe_marker.png",
          "description": "Texture path (optional)"
        },
        {
          "name": "shape",
          "type": "string",
          "default": "square",
          "options": ["square", "circle"],
          "description": "Shape: square (uses texture as-is) or circle (applies circular mask)"
        }
      ]
    },
    {
      "id": "projectile",
      "category": "Visual",
      "name": "Projectile",
      "description": "Flying projectile from source to target",
      "template": {
        "kind": "Play",
        "effectId": "projectile",
        "source": "$actor",
        "target": "$patient",
        "ctx": {
          "projectileWidth": 2,
          "projectileHeadWidth": 0.5,
          "projectileRadius": 0.2,
          "projectileTexture": "effects/arrow.png",
          "speed": 20,
          "rotationSpeed": 5,
          "color": "#ffffff"
        }
      },
      "parameters": [
        {
          "name": "startPosition",
          "type": "vector3",
          "description": "Start position (uses source if not provided)"
        },
        {
          "name": "targetPosition",
          "type": "vector3",
          "description": "Target position (uses target if not provided)"
        },
        {
          "name": "projectileWidth",
          "type": "number",
          "default": 2,
          "description": "Total length of projectile"
        },
        {
          "name": "projectileHeadWidth",
          "type": "number",
          "default": 0.5,
          "description": "Length of tapered head section"
        },
        {
          "name": "projectileRadius",
          "type": "number",
          "default": 0.2,
          "description": "Radius/thickness of projectile"
        },
        {
          "name": "projectileTexture",
          "type": "string",
          "default": "effects/arrow.png",
          "description": "Texture path"
        },
        {
          "name": "speed",
          "type": "number",
          "default": 20,
          "description": "Flight speed (units/second)"
        },
        {
          "name": "rotationSpeed",
          "type": "number",
          "default": 5,
          "description": "Rotation speed (radians/second)"
        },
        {
          "name": "color",
          "type": "color",
          "default": "#ffffff",
          "description": "Color tint"
        }
      ]
    }
  ],
  "commands": [
    {
      "id": "cmd_notification",
      "category": "UI",
      "name": "Show Notification",
      "description": "Display a notification message",
      "template": {
        "kind": "Cmd",
        "cmd": "notification",
        "parameters": [0, "null", "Message"]
      },
      "parameters": [
        {
          "name": "type",
          "type": "number",
          "default": 0,
          "description": "Notification type (0=system, 10-12=chat, 20-21=overlay, 30-31=quest)"
        },
        {
          "name": "from",
          "type": "string",
          "default": "null",
          "description": "Sender name or 'null' for no sender"
        },
        {
          "name": "message",
          "type": "string",
          "default": "Message",
          "description": "Notification message text"
        }
      ]
    },
    {
      "id": "cmd_teleport",
      "category": "Player",
      "name": "Teleport",
      "description": "Teleport player to coordinates",
      "template": {
        "kind": "Cmd",
        "cmd": "teleport",
        "parameters": [0, 64, 0]
      },
      "parameters": [
        {
          "name": "x",
          "type": "number",
          "default": 0,
          "description": "X coordinate"
        },
        {
          "name": "y",
          "type": "number",
          "default": 64,
          "description": "Y coordinate"
        },
        {
          "name": "z",
          "type": "number",
          "default": 0,
          "description": "Z coordinate"
        }
      ]
    },
    {
      "id": "cmd_flash_image",
      "category": "Visual",
      "name": "Flash Image",
      "description": "Display a flash image overlay",
      "template": {
        "kind": "Cmd",
        "cmd": "flashImage",
        "parameters": ["path/to/image.png", 1000]
      },
      "parameters": [
        {
          "name": "imagePath",
          "type": "string",
          "default": "path/to/image.png",
          "description": "Path to image file"
        },
        {
          "name": "duration",
          "type": "number",
          "default": 1000,
          "description": "Duration in milliseconds"
        }
      ]
    },
    {
      "id": "cmd_center_text",
      "category": "Visual",
      "name": "Center Text",
      "description": "Display centered text overlay",
      "template": {
        "kind": "Cmd",
        "cmd": "centerText",
        "parameters": ["Text", 2000]
      },
      "parameters": [
        {
          "name": "text",
          "type": "string",
          "default": "Text",
          "description": "Text to display"
        },
        {
          "name": "duration",
          "type": "number",
          "default": 2000,
          "description": "Duration in milliseconds"
        }
      ]
    },
    {
      "id": "cmd_play_sound",
      "category": "Audio",
      "name": "Play Sound",
      "description": "Play a sound effect",
      "template": {
        "kind": "Cmd",
        "cmd": "playSound",
        "parameters": ["audio/effects/sound.ogg", 1.0]
      },
      "parameters": [
        {
          "name": "soundPath",
          "type": "string",
          "default": "audio/effects/sound.ogg",
          "description": "Path to sound file"
        },
        {
          "name": "volume",
          "type": "number",
          "default": 1.0,
          "description": "Volume (0.0 - 1.0)"
        }
      ]
    },
    {
      "id": "cmd_play_sound_at_position",
      "category": "Audio",
      "name": "Play Sound at Position",
      "description": "Play a 3D positioned sound effect",
      "template": {
        "kind": "Cmd",
        "cmd": "playSoundAtPosition",
        "parameters": ["audio/effects/sound.ogg", 0, 64, 0, 1.0]
      },
      "parameters": [
        {
          "name": "soundPath",
          "type": "string",
          "default": "audio/effects/sound.ogg",
          "description": "Path to sound file"
        },
        {
          "name": "x",
          "type": "number",
          "default": 0,
          "description": "X coordinate"
        },
        {
          "name": "y",
          "type": "number",
          "default": 64,
          "description": "Y coordinate"
        },
        {
          "name": "z",
          "type": "number",
          "default": 0,
          "description": "Z coordinate"
        },
        {
          "name": "volume",
          "type": "number",
          "default": 1.0,
          "description": "Volume (0.0 - 1.0)"
        }
      ]
    },
    {
      "id": "cmd_underwater",
      "category": "Environment",
      "name": "Underwater Effect",
      "description": "Toggle underwater visual effect",
      "template": {
        "kind": "Cmd",
        "cmd": "underwater",
        "parameters": [true]
      },
      "parameters": [
        {
          "name": "enabled",
          "type": "boolean",
          "default": true,
          "description": "Enable/disable underwater effect"
        }
      ]
    },
    {
      "id": "cmd_fog",
      "category": "Environment",
      "name": "Fog Effect",
      "description": "Set fog intensity",
      "template": {
        "kind": "Cmd",
        "cmd": "fog",
        "parameters": [0.5]
      },
      "parameters": [
        {
          "name": "intensity",
          "type": "number",
          "default": 0.5,
          "description": "Fog intensity (0.0 - 1.0)"
        }
      ]
    }
  ],
  "stepTemplates": [
    {
      "id": "wait_short",
      "name": "Wait (Short)",
      "category": "Timing",
      "description": "Wait for a short duration",
      "template": {
        "kind": "Wait",
        "seconds": 0.5
      }
    },
    {
      "id": "wait_medium",
      "name": "Wait (Medium)",
      "category": "Timing",
      "description": "Wait for a medium duration",
      "template": {
        "kind": "Wait",
        "seconds": 2.0
      }
    },
    {
      "id": "wait_long",
      "name": "Wait (Long)",
      "category": "Timing",
      "description": "Wait for a long duration",
      "template": {
        "kind": "Wait",
        "seconds": 5.0
      }
    },
    {
      "id": "sequence_empty",
      "name": "Sequence (Empty)",
      "category": "Control Flow",
      "description": "Sequential execution of steps",
      "template": {
        "kind": "Sequence",
        "steps": []
      }
    },
    {
      "id": "parallel_empty",
      "name": "Parallel (Empty)",
      "category": "Control Flow",
      "description": "Parallel execution of steps",
      "template": {
        "kind": "Parallel",
        "steps": []
      }
    },
    {
      "id": "repeat_n",
      "name": "Repeat N Times",
      "category": "Control Flow",
      "description": "Repeat a step N times",
      "template": {
        "kind": "Repeat",
        "times": 3,
        "step": {
          "kind": "Wait",
          "seconds": 1
        }
      }
    },
    {
      "id": "if_condition",
      "name": "If Condition",
      "category": "Control Flow",
      "description": "Conditional execution",
      "template": {
        "kind": "If",
        "cond": {
          "kind": "VarExists",
          "name": "variable"
        },
        "then": {
          "kind": "Wait",
          "seconds": 0
        }
      }
    },
    {
      "id": "foreach_patients",
      "name": "For Each Patient",
      "category": "Control Flow",
      "description": "Iterate over all patients/targets",
      "template": {
        "kind": "ForEach",
        "collection": "$patients",
        "itemVar": "$patient",
        "step": {
          "kind": "Wait",
          "seconds": 0.1
        }
      }
    }
  ],
  "exampleScripts": [
    {
      "id": "example_notification_sequence",
      "name": "Example: Notification Sequence",
      "description": "Shows a sequence of notifications with delays",
      "script": {
        "id": "notification_sequence",
        "description": "Display multiple notifications with timing",
        "root": {
          "kind": "Sequence",
          "steps": [
            {
              "kind": "Cmd",
              "cmd": "notification",
              "parameters": [0, "System", "Starting effect..."]
            },
            {
              "kind": "Wait",
              "seconds": 2
            },
            {
              "kind": "Cmd",
              "cmd": "notification",
              "parameters": [20, "null", "Effect activated!"]
            },
            {
              "kind": "Wait",
              "seconds": 1
            },
            {
              "kind": "Cmd",
              "cmd": "notification",
              "parameters": [0, "System", "Complete"]
            }
          ]
        }
      }
    },
    {
      "id": "example_teleport_with_feedback",
      "name": "Example: Teleport with Feedback",
      "description": "Teleport player with visual and audio feedback",
      "script": {
        "id": "teleport_feedback",
        "description": "Teleport with countdown and effects",
        "root": {
          "kind": "Sequence",
          "steps": [
            {
              "kind": "Cmd",
              "cmd": "centerText",
              "parameters": ["Teleporting in 3...", 1000]
            },
            {
              "kind": "Wait",
              "seconds": 1
            },
            {
              "kind": "Cmd",
              "cmd": "centerText",
              "parameters": ["2...", 1000]
            },
            {
              "kind": "Wait",
              "seconds": 1
            },
            {
              "kind": "Cmd",
              "cmd": "centerText",
              "parameters": ["1...", 1000]
            },
            {
              "kind": "Wait",
              "seconds": 1
            },
            {
              "kind": "Parallel",
              "steps": [
                {
                  "kind": "Cmd",
                  "cmd": "teleport",
                  "parameters": [0, 100, 0]
                },
                {
                  "kind": "Cmd",
                  "cmd": "flashImage",
                  "parameters": ["effects/teleport_flash.png", 500]
                }
              ]
            }
          ]
        }
      }
    },
    {
      "id": "example_conditional_effect",
      "name": "Example: Conditional Effect",
      "description": "Different effects based on conditions",
      "script": {
        "id": "conditional_demo",
        "description": "Demonstrates conditional execution",
        "root": {
          "kind": "Sequence",
          "steps": [
            {
              "kind": "SetVar",
              "name": "hasTargets",
              "value": true
            },
            {
              "kind": "If",
              "cond": {
                "kind": "VarEquals",
                "name": "hasTargets",
                "value": true
              },
              "then": {
                "kind": "Cmd",
                "cmd": "notification",
                "parameters": [0, "System", "Targets found!"]
              },
              "else": {
                "kind": "Cmd",
                "cmd": "notification",
                "parameters": [0, "System", "No targets"]
              }
            }
          ]
        }
      }
    },
    {
      "id": "example_for_each_patients",
      "name": "Example: Attack All Targets",
      "description": "Execute effect for each patient/target",
      "script": {
        "id": "attack_all",
        "description": "Attack each target with delay",
        "root": {
          "kind": "ForEach",
          "collection": "$patients",
          "itemVar": "$patient",
          "step": {
            "kind": "Sequence",
            "steps": [
              {
                "kind": "Play",
                "effectId": "log",
                "ctx": {
                  "message": "Attacking target"
                }
              },
              {
                "kind": "Wait",
                "seconds": 0.5
              }
            ]
          }
        }
      }
    },
    {
      "id": "example_repeat_pulse",
      "name": "Example: Pulse Effect",
      "description": "Repeating pulse effect",
      "script": {
        "id": "pulse_effect",
        "description": "Visual pulse effect that repeats",
        "root": {
          "kind": "Repeat",
          "times": 5,
          "step": {
            "kind": "Sequence",
            "steps": [
              {
                "kind": "Cmd",
                "cmd": "flashImage",
                "parameters": ["effects/pulse.png", 300]
              },
              {
                "kind": "Wait",
                "seconds": 0.3
              }
            ]
          }
        }
      }
    },
    {
      "id": "example_lod_effect",
      "name": "Example: LOD-based Effect",
      "description": "Different effects based on graphics quality",
      "script": {
        "id": "lod_demo",
        "description": "Demonstrates LOD switching",
        "root": {
          "kind": "LodSwitch",
          "levels": {
            "high": {
              "kind": "Sequence",
              "steps": [
                {
                  "kind": "Play",
                  "effectId": "log",
                  "ctx": {
                    "message": "High quality effect"
                  }
                }
              ]
            },
            "medium": {
              "kind": "Play",
              "effectId": "log",
              "ctx": {
                "message": "Medium quality effect"
              }
            },
            "low": {
              "kind": "Play",
              "effectId": "log",
              "ctx": {
                "message": "Low quality effect"
              }
            }
          }
        }
      }
    },
    {
      "id": "example_event_coordination",
      "name": "Example: Event Coordination",
      "description": "Parallel actions coordinated via events",
      "script": {
        "id": "event_demo",
        "description": "Demonstrates event emission and waiting",
        "root": {
          "kind": "Parallel",
          "steps": [
            {
              "kind": "Sequence",
              "steps": [
                {
                  "kind": "WaitEvent",
                  "name": "explosion_ready",
                  "timeout": 5
                },
                {
                  "kind": "Cmd",
                  "cmd": "notification",
                  "parameters": [20, "null", "BOOM!"]
                }
              ]
            },
            {
              "kind": "Sequence",
              "steps": [
                {
                  "kind": "Cmd",
                  "cmd": "centerText",
                  "parameters": ["Warning...", 1500]
                },
                {
                  "kind": "Wait",
                  "seconds": 1.5
                },
                {
                  "kind": "EmitEvent",
                  "name": "explosion_ready"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "id": "example_complex_ability",
      "name": "Example: Complex Ability",
      "description": "Complete ability with all features",
      "script": {
        "id": "fireball_ability",
        "description": "Fireball ability with charge-up, cast, and cooldown",
        "parameters": [
          {
            "name": "damage",
            "type": "number",
            "default": 50,
            "description": "Damage amount"
          },
          {
            "name": "radius",
            "type": "number",
            "default": 5,
            "description": "Effect radius"
          }
        ],
        "root": {
          "kind": "Sequence",
          "steps": [
            {
              "kind": "Cmd",
              "cmd": "notification",
              "parameters": [0, "Caster", "Charging fireball..."]
            },
            {
              "kind": "Parallel",
              "steps": [
                {
                  "kind": "Cmd",
                  "cmd": "playSound",
                  "parameters": ["audio/magic/charge.ogg", 0.8]
                },
                {
                  "kind": "Cmd",
                  "cmd": "centerText",
                  "parameters": ["Charging...", 2000]
                }
              ]
            },
            {
              "kind": "Wait",
              "seconds": 2
            },
            {
              "kind": "Cmd",
              "cmd": "notification",
              "parameters": [20, "null", "FIREBALL!"]
            },
            {
              "kind": "If",
              "cond": {
                "kind": "HasTargets",
                "min": 1
              },
              "then": {
                "kind": "ForEach",
                "collection": "$patients",
                "itemVar": "$patient",
                "step": {
                  "kind": "Play",
                  "effectId": "log",
                  "ctx": {
                    "message": "Fireball hit target!",
                    "level": "info"
                  }
                }
              },
                "else": {
                  "kind": "Play",
                  "effectId": "log",
                  "ctx": {
                    "message": "Fireball missed - no targets",
                    "level": "warn"
                  }
                }
            }
          ]
        }
      }
    }
  ]
}
