{
  "$schema": "https://example.com/scrawl-step-definitions.schema.json",
  "version": "1.0.0",
  "description": "Step type definitions for the Scrawl visual editor",
  "stepTypes": {
    "Play": {
      "name": "Play Effect",
      "description": "Play an effect or action",
      "category": "Effects",
      "icon": "‚ñ∂Ô∏è",
      "color": "primary",
      "template": {
        "kind": "Play",
        "effectId": "",
        "ctx": {}
      },
      "fields": [
        {
          "name": "effectId",
          "label": "Effect ID",
          "type": "string",
          "required": true,
          "placeholder": "effect_name"
        },
        {
          "name": "source",
          "label": "Source",
          "type": "string",
          "placeholder": "$actor"
        },
        {
          "name": "target",
          "label": "Target",
          "type": "string",
          "placeholder": "$patient"
        },
        {
          "name": "ctx",
          "label": "Context",
          "type": "json",
          "placeholder": "{}"
        }
      ],
      "hasSubSteps": false
    },
    "Wait": {
      "name": "Wait",
      "description": "Wait for a duration",
      "category": "Timing",
      "icon": "‚è±Ô∏è",
      "color": "secondary",
      "template": {
        "kind": "Wait",
        "seconds": 1
      },
      "fields": [
        {
          "name": "seconds",
          "label": "Seconds",
          "type": "number",
          "required": true,
          "min": 0,
          "step": 0.1,
          "default": 1
        }
      ],
      "hasSubSteps": false
    },
    "Cmd": {
      "name": "Command",
      "description": "Execute a command",
      "category": "Commands",
      "icon": "‚ö°",
      "color": "accent",
      "template": {
        "kind": "Cmd",
        "cmd": "",
        "parameters": []
      },
      "fields": [
        {
          "name": "cmd",
          "label": "Command",
          "type": "string",
          "required": true,
          "placeholder": "notification"
        },
        {
          "name": "parameters",
          "label": "Parameters",
          "type": "array",
          "itemType": "any",
          "default": []
        }
      ],
      "hasSubSteps": false
    },
    "Sequence": {
      "name": "Sequence",
      "description": "Execute steps in order",
      "category": "Control Flow",
      "icon": "üìã",
      "color": "info",
      "template": {
        "kind": "Sequence",
        "steps": []
      },
      "fields": [],
      "hasSubSteps": true,
      "subStepsType": "array",
      "subStepsField": "steps"
    },
    "Parallel": {
      "name": "Parallel",
      "description": "Execute steps concurrently",
      "category": "Control Flow",
      "icon": "‚ö°",
      "color": "warning",
      "template": {
        "kind": "Parallel",
        "steps": []
      },
      "fields": [],
      "hasSubSteps": true,
      "subStepsType": "array",
      "subStepsField": "steps"
    },
    "Repeat": {
      "name": "Repeat",
      "description": "Repeat a step multiple times",
      "category": "Control Flow",
      "icon": "üîÅ",
      "color": "success",
      "template": {
        "kind": "Repeat",
        "times": 3,
        "step": {
          "kind": "Wait",
          "seconds": 1
        }
      },
      "fields": [
        {
          "name": "times",
          "label": "Times",
          "type": "number",
          "min": 1,
          "placeholder": "Leave empty for infinite"
        },
        {
          "name": "untilEvent",
          "label": "Until Event",
          "type": "string",
          "placeholder": "event_name"
        }
      ],
      "hasSubSteps": true,
      "subStepsType": "single",
      "subStepsField": "step"
    },
    "ForEach": {
      "name": "For Each",
      "description": "Iterate over a collection",
      "category": "Control Flow",
      "icon": "üîÑ",
      "color": "primary",
      "template": {
        "kind": "ForEach",
        "collection": "$patients",
        "itemVar": "$patient",
        "step": {
          "kind": "Wait",
          "seconds": 0.1
        }
      },
      "fields": [
        {
          "name": "collection",
          "label": "Collection",
          "type": "string",
          "required": true,
          "default": "$patients",
          "placeholder": "$patients"
        },
        {
          "name": "itemVar",
          "label": "Item Variable",
          "type": "string",
          "required": true,
          "default": "$patient",
          "placeholder": "$patient"
        }
      ],
      "hasSubSteps": true,
      "subStepsType": "single",
      "subStepsField": "step"
    },
    "If": {
      "name": "If Condition",
      "description": "Conditional execution",
      "category": "Control Flow",
      "icon": "‚ùì",
      "color": "warning",
      "template": {
        "kind": "If",
        "cond": {
          "kind": "VarExists",
          "name": "variable"
        },
        "then": {
          "kind": "Wait",
          "seconds": 0
        }
      },
      "fields": [
        {
          "name": "cond",
          "label": "Condition",
          "type": "condition",
          "required": true
        }
      ],
      "hasSubSteps": true,
      "subStepsType": "branches",
      "subStepsFields": ["then", "else"]
    },
    "LodSwitch": {
      "name": "LOD Switch",
      "description": "Different effects for quality levels",
      "category": "Optimization",
      "icon": "üéöÔ∏è",
      "color": "info",
      "template": {
        "kind": "LodSwitch",
        "levels": {
          "high": { "kind": "Wait", "seconds": 0 },
          "medium": { "kind": "Wait", "seconds": 0 },
          "low": { "kind": "Wait", "seconds": 0 }
        }
      },
      "fields": [],
      "hasSubSteps": true,
      "subStepsType": "map",
      "subStepsFields": ["levels.high", "levels.medium", "levels.low"]
    },
    "Call": {
      "name": "Call Script",
      "description": "Call another script or sequence",
      "category": "Control Flow",
      "icon": "üìû",
      "color": "secondary",
      "template": {
        "kind": "Call",
        "scriptId": "",
        "args": {}
      },
      "fields": [
        {
          "name": "scriptId",
          "label": "Script ID",
          "type": "string",
          "required": true,
          "placeholder": "script_name"
        },
        {
          "name": "args",
          "label": "Arguments",
          "type": "json",
          "default": {}
        }
      ],
      "hasSubSteps": false
    },
    "SetVar": {
      "name": "Set Variable",
      "description": "Set a variable value",
      "category": "Variables",
      "icon": "üíæ",
      "color": "ghost",
      "template": {
        "kind": "SetVar",
        "name": "",
        "value": ""
      },
      "fields": [
        {
          "name": "name",
          "label": "Variable Name",
          "type": "string",
          "required": true,
          "placeholder": "variableName"
        },
        {
          "name": "value",
          "label": "Value",
          "type": "any",
          "placeholder": "value"
        }
      ],
      "hasSubSteps": false
    },
    "EmitEvent": {
      "name": "Emit Event",
      "description": "Emit an event",
      "category": "Events",
      "icon": "üì°",
      "color": "success",
      "template": {
        "kind": "EmitEvent",
        "name": "",
        "payload": {}
      },
      "fields": [
        {
          "name": "name",
          "label": "Event Name",
          "type": "string",
          "required": true,
          "placeholder": "event_name"
        },
        {
          "name": "payload",
          "label": "Payload",
          "type": "json",
          "default": {}
        }
      ],
      "hasSubSteps": false
    },
    "WaitEvent": {
      "name": "Wait Event",
      "description": "Wait for an event",
      "category": "Events",
      "icon": "‚è≥",
      "color": "info",
      "template": {
        "kind": "WaitEvent",
        "name": "",
        "timeout": 0
      },
      "fields": [
        {
          "name": "name",
          "label": "Event Name",
          "type": "string",
          "required": true,
          "placeholder": "event_name"
        },
        {
          "name": "timeout",
          "label": "Timeout (seconds)",
          "type": "number",
          "min": 0,
          "default": 0,
          "placeholder": "0 = no timeout"
        }
      ],
      "hasSubSteps": false
    }
  },
  "conditionTypes": {
    "VarEquals": {
      "name": "Variable Equals",
      "template": { "kind": "VarEquals", "name": "", "value": "" },
      "fields": [
        { "name": "name", "label": "Variable", "type": "string", "required": true },
        { "name": "value", "label": "Value", "type": "any" }
      ]
    },
    "VarExists": {
      "name": "Variable Exists",
      "template": { "kind": "VarExists", "name": "" },
      "fields": [
        { "name": "name", "label": "Variable", "type": "string", "required": true }
      ]
    },
    "Chance": {
      "name": "Random Chance",
      "template": { "kind": "Chance", "p": 0.5 },
      "fields": [
        { "name": "p", "label": "Probability (0-1)", "type": "number", "min": 0, "max": 1, "step": 0.1, "required": true }
      ]
    },
    "HasTargets": {
      "name": "Has Targets",
      "template": { "kind": "HasTargets", "min": 1 },
      "fields": [
        { "name": "min", "label": "Minimum Count", "type": "number", "min": 0, "default": 1 }
      ]
    },
    "HasSource": {
      "name": "Has Source",
      "template": { "kind": "HasSource" },
      "fields": []
    },
    "IsVarTrue": {
      "name": "Variable Is True",
      "template": { "kind": "IsVarTrue", "name": "", "defaultValue": false },
      "fields": [
        { "name": "name", "label": "Variable", "type": "string", "required": true },
        { "name": "defaultValue", "label": "Default Value", "type": "boolean", "default": false }
      ]
    },
    "IsVarFalse": {
      "name": "Variable Is False",
      "template": { "kind": "IsVarFalse", "name": "", "defaultValue": true },
      "fields": [
        { "name": "name", "label": "Variable", "type": "string", "required": true },
        { "name": "defaultValue", "label": "Default Value", "type": "boolean", "default": true }
      ]
    }
  }
}
